<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Dashboard</title>

    <!-- Bootstrap + Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        .chart-card {
            height: 100%;
        }
        .chart-canvas-container {
            height: 200px;
            width: 100%;
        }
        .gauge-fill {
            border-radius: 0.375rem;
        }
    </style>
</head>

<body class="bg-light">

<!-- NAVBAR -->
<div th:replace="fragments/navbar :: navbar"></div>

<div class="container py-5">

    <h1 class="mb-4 text-dark">
        <i class="bi bi-bar-chart-line-fill text-primary me-2"></i> Dashboard
    </h1>

    <div class="row">

        <!-- LEFT CONTENT AREA -->
        <div class="col-lg-9 col-md-8">

            <!-- Mood + Activity Row -->
            <div class="row mb-4">

                <!-- Weekly Mood Trend -->
                <div class="col-md-6 mb-3">
                    <div class="card shadow-sm chart-card border-0">
                        <div class="card-header bg-primary text-white border-0">
                            <h5 class="mb-0">
                                <i class="bi bi-lightning-charge-fill me-2"></i>Weekly Mood Trend
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-canvas-container">
                                <canvas id="dashboardMoodChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Activity Distribution -->
                <div class="col-md-6 mb-3">
                    <div class="card shadow-sm chart-card border-0">
                        <div class="card-header bg-secondary text-white border-0">
                            <h5 class="mb-0">
                                <i class="bi bi-pie-chart-fill me-2"></i>Activity Distribution
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-canvas-container">
                                <canvas id="activityChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Assessment History -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card shadow-sm border-0">
                        <div class="card-header bg-success text-white border-0">
                            <h5 class="mb-0"><i class="bi bi-graph-up me-2"></i>Assessment History</h5>
                        </div>
                        <div class="card-body">
                            <div class="chart-canvas-container" style="height: 250px;">
                                <canvas id="assessmentChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- RIGHT CONTENT AREA -->
        <div class="col-lg-3 col-md-4">

            <!-- Weekly Goal Completion -->
            <div class="card shadow-sm mb-4 border-0">
                <div class="card-header bg-warning text-dark border-0">
                    <h5 class="mb-0">
                        <i class="bi bi-bullseye me-2"></i>Weekly Goal Completion
                    </h5>
                </div>
                <div class="card-body text-center">

                    <!-- Example: bind to model number -->
                    <h2 id="gaugeValue"
                        class="display-4 fw-bold mb-3 text-warning"
                        th:text="${weeklyGoalPercent + '%'}">85%</h2>

                    <div class="progress" style="height: 20px;">
                        <div id="gaugeBar"
                             class="progress-bar bg-warning gauge-fill"
                             th:style="'width:' + ${weeklyGoalPercent} + '%'"
                             role="progressbar">
                        </div>
                    </div>

                </div>
            </div>

            <!-- Achievements List -->
            <div class="card shadow-sm mb-4 border-0">
                <div class="card-header bg-dark text-white border-0">
                    <h5 class="mb-0"><i class="bi bi-award-fill me-2"></i>Achievements</h5>
                </div>

                <div class="card-body p-0">
                    <ul class="list-group list-group-flush">

                        <li class="list-group-item d-flex align-items-center"
                            th:each="ach : ${achievements}">
                            <i class="bi bi-check-circle-fill text-success me-2"></i>
                            <span th:text="${ach}"></span>
                        </li>

                        <li class="list-group-item text-muted text-center"
                            th:if="${#lists.isEmpty(achievements)}">
                            No recent achievements.
                        </li>

                    </ul>
                </div>

                <div class="card-footer text-center">
                    <a href="/progress/student-progress"
                       class="btn btn-outline-dark btn-sm w-100">See All Details</a>
                </div>

            </div>

        </div>

    </div>
</div>

<!-- ChartJS -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script th:inline="javascript">
/*<![CDATA[*/

const PRIMARY_COLOR = 'rgba(0, 123, 255, 1)';
const PRIMARY_COLOR_LIGHT = 'rgba(0, 123, 255, 0.2)';

/* ------------------ 1. WEEKLY MOOD TREND ------------------ */

var moodData = [[${dashboardMoodChartData}]];

var ctxMood = document.getElementById("dashboardMoodChart");
new Chart(ctxMood, {
    type: 'line',
    data: {
        labels: moodData.map(e => e.date),
        datasets: [{
            label: "Mood Score (0â€“4)",
            data: moodData.map(e => e.moodValue),
            backgroundColor: PRIMARY_COLOR_LIGHT,
            borderColor: PRIMARY_COLOR,
            borderWidth: 3,
            tension: 0.4,
            fill: true,
            pointRadius: 5
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: {
            y: {
                min: 0,
                max: 4,
                ticks: {
                    stepSize: 1,
                    callback: (value) => ["Terrible ðŸ˜¢","Bad ðŸ˜","Good ðŸ˜Š","Great ðŸ˜„","Excellent ðŸ¤©"][value]
                }
            },
            x: { grid: { display: false } }
        }
    }
});

/* ------------------ 2. ACTIVITY DISTRIBUTION ------------------ */

const ACTIVITY_COLORS = ['#0d6efd','#6c757d','#198754','#ffc107','#dc3545'];

var activityData = {
    labels: ['Study','Exercise','Social','Rest','Other'],
    datasets: [{
        data: [5, 3, 2, 4, 1],   // You can bind real data later
        backgroundColor: ACTIVITY_COLORS
    }]
};

var ctxActivity = document.getElementById("activityChart");
new Chart(ctxActivity, {
    type: 'doughnut',
    data: activityData,
    options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: "70%",
        plugins: { legend: { position: "bottom" } }
    }
});

/* ------------------ 3. ASSESSMENT HISTORY ------------------ */

var assessmentData = {
    labels: ['Quiz 1','Exam 1','Quiz 2','Final'],
    datasets: [
        {
            label: "Assessment (%)",
            data: [70,80,75,90],
            backgroundColor: "rgba(25,135,84,0.4)",
            borderColor: "rgba(25,135,84,1)",
            type: "bar",
            borderWidth: 2
        },
        {
            label: "Trend Line",
            data: [70,80,75,90],
            borderColor: PRIMARY_COLOR,
            type: "line",
            tension: 0.3,
            fill: false
        }
    ]
};

var ctxAssess = document.getElementById("assessmentChart");
new Chart(ctxAssess, {
    type: "bar",
    data: assessmentData,
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: { y: { min: 0, max: 100 } }
    }
});

/*]]>*/
</script>

</body>
</html>
