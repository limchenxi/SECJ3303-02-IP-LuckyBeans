<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>My Mood Tracker üåà</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />

    <style>
        /* Custom colors for better visual distinction */
        .btn-outline-custom-happy {
            --bs-btn-color: #28a745;
            --bs-btn-border-color: #28a745;
            --bs-btn-hover-bg: #28a745;
            --bs-btn-hover-border-color: #28a45;
            --bs-btn-active-bg: #28a745;
            --bs-btn-active-border-color: #28a745;
        }
        .btn-outline-custom-sad {
            --bs-btn-color: #007bff;
            --bs-btn-border-color: #007bff;
            --bs-btn-hover-bg: #007bff;
            --bs-btn-hover-border-color: #007bff;
            --bs-btn-active-bg: #007bff;
            --bs-btn-active-border-color: #007bff;
        }
        .btn-outline-custom-angry {
            --bs-btn-color: #dc3545;
            --bs-btn-border-color: #dc3545;
            --bs-btn-hover-bg: #dc3545;
            --bs-btn-hover-border-color: #dc3545;
            --bs-btn-active-bg: #dc3545;
            --bs-btn-active-border-color: #dc3545;
        }
        .btn-outline-custom-excited {
            --bs-btn-color: #ffc107;
            --bs-btn-border-color: #ffc107;
            --bs-btn-hover-bg: #ffc107;
            --bs-btn-hover-border-color: #ffc107;
            --bs-btn-active-bg: #ffc107;
            --bs-btn-active-border-color: #ffc107;
        }
        .btn-outline-custom-neutral {
            --bs-btn-color: #6c757d;
            --bs-btn-border-color: #6c757d;
            --bs-btn-hover-bg: #6c757d;
            --bs-btn-hover-border-color: #6c757d;
            --bs-btn-active-bg: #6c757d;
            --bs-btn-active-border-color: #6c757d;
        }

        /* Hover Text Colors */
        .btn-check:checked + .btn-outline-custom-happy,
        .btn-outline-custom-happy:hover,
        .btn-outline-custom-happy:active {
            color: #fff;
        }

        .btn-check:checked + .btn-outline-custom-sad,
        .btn-outline-custom-sad:hover,
        .btn-outline-custom-sad:active {
            color: #fff;
        }

        .btn-check:checked + .btn-outline-custom-angry,
        .btn-outline-custom-angry:hover,
        .btn-outline-custom-angry:active {
            color: #fff;
        }

        .btn-check:checked + .btn-outline-custom-excited,
        .btn-outline-custom-excited:hover,
        .btn-outline-custom-excited:active {
            color: #212529;
        }

        .btn-check:checked + .btn-outline-custom-neutral,
        .btn-outline-custom-neutral:hover,
        .btn-outline-custom-neutral:active {
            color: #fff;
        }

        /* Slight emphasis on active buttons */
        .btn-check:checked + .btn, .btn:hover, .btn:active {
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-light">

<div th:replace="fragments/navbar :: navbar"></div>

<div class="container py-5">
    <div class="row">

        <!-- Mood Selection -->
        <div class="col-lg-6 col-md-8 mx-auto mb-5">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-primary text-white text-center py-3 rounded-top-3">
                    <h2 class="mb-0 fs-3">How are you feeling right now? ü§î</h2>
                </div>
                <div class="card-body p-4">
                    <form th:action="@{/progress/mood}" method="post">

                        <div class="mb-4">
                            <label class="form-label fs-5 fw-bold mb-3">Choose your mood:</label>
                            <div class="row row-cols-3 row-cols-sm-5 g-3 justify-content-center">

                                <div class="col">
                                    <input type="radio" class="btn-check" name="mood" id="happy" value="Happy üòä" autocomplete="off" required>
                                    <label class="btn btn-outline-custom-happy w-100 py-3 d-flex flex-column align-items-center" for="happy">
                                        <span class="fs-2">üòä</span>
                                        <span class="fs-6 mt-1">Happy</span>
                                    </label>
                                </div>

                                <div class="col">
                                    <input type="radio" class="btn-check" name="mood" id="excited" value="Excited ü§©" autocomplete="off">
                                    <label class="btn btn-outline-custom-excited w-100 py-3 d-flex flex-column align-items-center" for="excited">
                                        <span class="fs-2">ü§©</span>
                                        <span class="fs-6 mt-1">Excited</span>
                                    </label>
                                </div>

                                <div class="col">
                                    <input type="radio" class="btn-check" name="mood" id="neutral" value="Neutral üòê" autocomplete="off">
                                    <label class="btn btn-outline-custom-neutral w-100 py-3 d-flex flex-column align-items-center" for="neutral">
                                        <span class="fs-2">üòê</span>
                                        <span class="fs-6 mt-1">Neutral</span>
                                    </label>
                                </div>

                                <div class="col">
                                    <input type="radio" class="btn-check" name="mood" id="sad" value="Sad üò¢" autocomplete="off">
                                    <label class="btn btn-outline-custom-sad w-100 py-3 d-flex flex-column align-items-center" for="sad">
                                        <span class="fs-2">üò¢</span>
                                        <span class="fs-6 mt-1">Sad</span>
                                    </label>
                                </div>

                                <div class="col">
                                    <input type="radio" class="btn-check" name="mood" id="angry" value="Angry üò†" autocomplete="off">
                                    <label class="btn btn-outline-custom-angry w-100 py-3 d-flex flex-column align-items-center" for="angry">
                                        <span class="fs-2">üò†</span>
                                        <span class="fs-6 mt-1">Angry</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="note-input" class="form-label fs-5 fw-bold">Note / Thoughts (Optional)</label>
                            <textarea id="note-input" name="note" class="form-control" rows="3" placeholder="What led to this mood?" maxlength="255"></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary btn-lg w-100 mt-2">Log My Mood üìù</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Content -->
        <div class="col-lg-10 mx-auto">
            <div class="row">

                <!-- Mood Trend Chart -->
                <div class="col-lg-7 mb-4">
                    <div class="card shadow border-info">
                        <div class="card-header bg-info text-white py-3">
                            <h3 class="mb-0 fs-4">Weekly Mood Trend üìà</h3>
                        </div>
                        <div class="card-body">
                            <canvas id="moodChart" height="100"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Insights -->
                <div class="col-lg-5 mb-4">
                    <div class="card shadow border-success h-100">
                        <div class="card-header bg-success text-white py-3">
                            <h3 class="mb-0 fs-4">Activity & Mood Insights üí°</h3>
                        </div>
                        <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                            <p class="lead text-muted">Future Feature</p>
                            <p>See how your activities and habits affect your daily mood and well-being. <b>Coming Soon!</b></p>
                        </div>
                    </div>
                </div>

                <!-- Recent Entries -->
                <div class="col-12">
                    <div class="card shadow mb-4 border-secondary">
                        <div class="card-header bg-secondary text-white py-3">
                            <h3 class="mb-0 fs-4">Your Recent Entries üìÖ</h3>
                        </div>

                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover mb-0">
                                    <thead class="table-light">
                                        <tr>
                                            <th scope="col" class="w-25">Date</th>
                                            <th scope="col" class="w-25">Mood</th>
                                            <th scope="col">Note</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="entry : ${entries}">
                                            <td th:text="${entry.date}"></td>
                                            <td th:text="${entry.mood}"></td>
                                            <td th:text="${entry.note}"></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>

            </div>
        </div>

    </div>
</div>

<!-- JS Libraries -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Chart Logic -->
<script th:inline="javascript">
/*<![CDATA[*/

var moodData = /*[[${moodChartData}]]*/ [];

// Mood mapping for labels & colors
const moodMap = {
    0: { label: 'üò¢ Sad', color: 'rgba(0, 123, 255, 0.7)' },
    1: { label: 'üòê Neutral', color: 'rgba(108, 117, 125, 0.7)' },
    2: { label: 'üòä Happy', color: 'rgba(40, 167, 69, 0.7)' },
    3: { label: 'ü§© Excited', color: 'rgba(255, 193, 7, 0.7)' },
    4: { label: 'üò† Angry', color: 'rgba(220, 53, 69, 0.7)' }
};

var ctx = document.getElementById('moodChart').getContext('2d');

var chart = new Chart(ctx, {
    type: 'bar',
    data: {
        labels: moodData.map(e => e.date),
        datasets: [{
            label: 'Daily Mood Score',
            data: moodData.map(e => e.moodValue),
            backgroundColor: moodData.map(e => moodMap[e.moodValue]?.color || 'rgba(54, 162, 235, 0.5)'),
            borderColor: 'rgba(54, 162, 235, 1)',
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false },
            tooltip: {
                callbacks: {
                    label: function(ctx) {
                        let v = ctx.parsed.y;
                        return moodMap[v] ? 'Mood: ' + moodMap[v].label : 'Value: ' + v;
                    }
                }
            }
        },
        scales: {
            y: {
                min: 0,
                max: 4,
                ticks: {
                    stepSize: 1,
                    callback: function(value) {
                        return moodMap[value] ? moodMap[value].label : value;
                    }
                }
            }
        }
    }
});

/*]]>*/
</script>

</body>
</html>
